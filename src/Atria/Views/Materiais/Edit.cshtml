@model Atria.Models.Material
@{
    ViewData["Title"] = "Editar Material";
}

<div class="page-container" style="max-width: 800px;">
    <div class="page-card">
        <div class="page-card-header">
    <h1><i class="bi bi-pencil-square me-2"></i>@ViewData["Title"]</h1>
  <p class="text-muted mb-0">Atualize as informações do material</p>
        </div>
      <div class="page-card-body">
   <form asp-action="Edit" method="post" id="formEditarMaterial">
                <input type="hidden" asp-for="Id" />
        
        <!-- Informações do Material Original -->
        <div class="alert alert-info mb-4">
     <div class="row">
  <div class="col-md-6">
       <small class="d-block text-muted">Criado por</small>
        <strong>@(Model.Criador?.Nome ?? "Desconhecido")</strong>
 </div>
       <div class="col-md-6">
        <small class="d-block text-muted">Data de Criação</small>
        <strong>@Model.DataCriacao.ToString("dd/MM/yyyy HH:mm")</strong>
         </div>
    </div>
        </div>

       <!-- Título -->
        <div class="mb-4">
     <label asp-for="Titulo" class="form-label fw-bold">
    <i class="bi bi-pencil me-1"></i>Título do Material
     <span class="text-danger">*</span>
      </label>
      <input class="form-control form-control-lg" 
          asp-for="Titulo" 
        placeholder="Ex: Clean Code - Um guia prático"
      maxlength="250" 
   id="tituloInput" />
  <span asp-validation-for="Titulo" class="text-danger"></span>
       <div class="form-text">
    <i class="bi bi-info-circle me-1"></i>
  <span id="tituloContador">@(Model.Titulo?.Length ?? 0)</span>/250 caracteres
      </div>
 </div>

    <!-- Tipo -->
<div class="mb-4">
      <label asp-for="Tipo" class="form-label fw-bold">
         <i class="bi bi-tag me-1"></i>Tipo de Material
           <span class="text-danger">*</span>
     </label>
     <div class="row g-3">
  <div class="col-6">
      <input type="radio" class="btn-check" name="Tipo" id="tipoLivro" value="Livro" 
              @(Model.Tipo == "Livro" ? "checked" : "")>
    <label class="btn btn-outline-primary w-100 p-3" for="tipoLivro">
     <i class="bi bi-book fs-3 d-block mb-2"></i>
 <strong>Livro</strong>
     <small class="d-block text-muted">Obras completas e extensas</small>
       </label>
   </div>
         <div class="col-6">
          <input type="radio" class="btn-check" name="Tipo" id="tipoArtigo" value="Artigo"
       @(Model.Tipo == "Artigo" ? "checked" : "")>
  <label class="btn btn-outline-primary w-100 p-3" for="tipoArtigo">
      <i class="bi bi-file-text fs-3 d-block mb-2"></i>
  <strong>Artigo</strong>
      <small class="d-block text-muted">Papers, artigos científicos</small>
    </label>
         </div>
   </div>
   </div>

       <!-- Descrição -->
      <div class="mb-4">
     <label asp-for="Descricao" class="form-label fw-bold">
    <i class="bi bi-align-left me-1"></i>Descrição
      </label>
       <textarea class="form-control" 
        asp-for="Descricao" 
rows="6"
     placeholder="Descreva brevemente o conteúdo, os tópicos abordados, para quem é indicado..."
       id="descricaoInput"
   maxlength="5000"></textarea>
       <div class="form-text">
       <i class="bi bi-info-circle me-1"></i>
          Forneça informações que ajudem outros usuários a entenderem do que se trata
   <span class="float-end">
         <span id="descricaoContador">@(Model.Descricao?.Length ?? 0)</span>/5000 caracteres
       </span>
       </div>
 </div>

       <!-- Status (se aplicável) -->
      @if (!string.IsNullOrEmpty(Model.Status))
     {
        <div class="mb-4">
       <label class="form-label fw-bold">
    <i class="bi bi-flag me-1"></i>Status Atual
    </label>
 <div>
     <span class="badge @(Model.Status == "Aprovado" ? "bg-success" : Model.Status == "Pendente" ? "bg-warning text-dark" : "bg-secondary") fs-6">
        @Model.Status
         </span>
      </div>
<small class="form-text text-muted">
    @if (Model.Status == "Pendente")
       {
       <span>Este material está aguardando aprovação de um moderador.</span>
  }
       else if (Model.Status == "Aprovado")
    {
       <span>Este material foi aprovado e está visível para todos os usuários.</span>
    }
    </small>
   </div>
 }

      <hr class="my-4">

        <!-- Botões de Ação -->
  <div class="d-flex gap-2 justify-content-between">
   <a class="btn btn-secondary" href="/Materiais/Details/@Model.Id">
        <i class="bi bi-arrow-left me-2"></i>Voltar
       </a>
   <div class="d-flex gap-2">
   <a class="btn btn-outline-secondary" href="/Materiais">
    <i class="bi bi-x-circle me-2"></i>Cancelar
 </a>
       <button class="btn btn-primary btn-lg" type="submit" id="btnSubmit">
     <i class="bi bi-check-circle me-2"></i>Salvar Alterações
    </button>
       </div>
    </div>
      </form>
        </div>
    </div>
</div>

<!-- Histórico de Alterações (mockup) -->
<div class="page-container mt-4" style="max-width: 800px;">
    <div class="page-card">
    <div class="page-card-header bg-light">
       <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>Informações</h5>
 </div>
        <div class="page-card-body">
     <ul class="list-unstyled mb-0">
      <li class="mb-2">
<i class="bi bi-calendar-check text-success me-2"></i>
     <strong>Criado em:</strong> @Model.DataCriacao.ToString("dd/MM/yyyy 'às' HH:mm")
      </li>
        @if (Model.Avaliacoes?.Any() == true)
       {
          <li class="mb-2">
         <i class="bi bi-star-fill text-warning me-2"></i>
     <strong>Avaliações:</strong> @Model.Avaliacoes.Count avaliação@(Model.Avaliacoes.Count != 1 ? "ões" : "")
       </li>
     }
   </ul>
        </div>
    </div>
</div>

<style>
    .btn-check:checked + .btn-outline-primary {
   background-color: #0d6efd;
        color: white;
transform: scale(1.05);
    }

    .btn-outline-primary {
     transition: all 0.3s ease;
    }

    .btn-outline-primary:hover {
   transform: scale(1.02);
    }

    #formEditarMaterial .form-control:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
    }
</style>

<script>
    // Contador de caracteres para Título
    const tituloInput = document.getElementById('tituloInput');
    const tituloContador = document.getElementById('tituloContador');
    
    if (tituloInput) {
 tituloInput.addEventListener('input', function() {
          tituloContador.textContent = this.value.length;
 });
    }

// Contador de caracteres para Descrição
    const descricaoInput = document.getElementById('descricaoInput');
    const descricaoContador = document.getElementById('descricaoContador');
 
    if (descricaoInput) {
   descricaoInput.addEventListener('input', function() {
   descricaoContador.textContent = this.value.length;
 });
    }

    // Validação antes de enviar
    document.getElementById('formEditarMaterial').addEventListener('submit', function(e) {
        const titulo = tituloInput.value.trim();
        
        if (titulo.length < 3) {
   e.preventDefault();
     alert('O título deve ter pelo menos 3 caracteres');
     tituloInput.focus();
            return false;
 }

  // Confirmação de alterações
        if (!confirm('Deseja salvar as alterações realizadas neste material?')) {
  e.preventDefault();
   return false;
 }

     // Animação no botão de submit
   const btnSubmit = document.getElementById('btnSubmit');
   btnSubmit.disabled = true;
    btnSubmit.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Salvando...';
    });

    // Detectar alterações não salvas
    let formModificado = false;
    const form = document.getElementById('formEditarMaterial');
    
    form.addEventListener('change', function() {
  formModificado = true;
    });

    window.addEventListener('beforeunload', function(e) {
  if (formModificado) {
       e.preventDefault();
   e.returnValue = '';
       return '';
     }
    });

    form.addEventListener('submit', function() {
    formModificado = false;
    });
</script>

@section Scripts{
    <partial name="_ValidationScriptsPartial" />
}